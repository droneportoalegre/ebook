<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DroneOps Check | Checklist de Voo</title>
  <meta name="description" content="App de checklist, histórico operacional e loja para operação de drones." />
  <meta name="theme-color" content="#103254" />
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="icon" href="./assets/icon-droneops.svg" type="image/svg+xml" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;600;700;800&family=IBM+Plex+Sans:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="hero shell">
    <div>
      <p class="tag">DroneOps Check</p>
      <h1>Checklist inteligente para todos os seus voos</h1>
      <p class="lead">Operador, missão, risco e decisão de decolagem com integração à interface do UAV Forecast.</p>
    </div>
    <div class="hero-actions">
      <button id="newFlightBtn" class="btn btn-primary">Novo voo</button>
      <button id="saveFlightBtn" class="btn btn-secondary">Salvar voo</button>
      <button id="exportJsonBtn" class="btn btn-ghost">Exportar JSON</button>
      <a class="btn btn-secondary" href="./assets/ebook-legislacao-drones-brasil-venda.pdf" target="_blank" rel="noopener noreferrer">E-book PDF</a>
    </div>
  </header>

  <nav class="shell top-tabs" aria-label="Navegação principal">
    <button class="tab-btn is-active" data-tab="checklist" type="button">Checklist</button>
    <button class="tab-btn" data-tab="historico" type="button">Histórico</button>
    <button class="tab-btn" data-tab="loja" type="button">Loja <span id="cartBadge" class="cart-badge">0</span></button>
  </nav>

  <main class="shell">
    <section id="screen-checklist" class="tab-screen is-active">
      <div class="grid">
        <section class="card span-3 ebook-highlight">
          <img class="ebook-cover" src="./assets/capa-ebook-drone-legal-brasil-mavic3pro-v2.svg" alt="Capa do e-book de legislação de drones no Brasil" />
          <div class="ebook-content">
            <p class="tag">E-book Oficial</p>
            <h2>Legislação de Drone no Brasil: da ANAC ao seguro RETA</h2>
            <p class="mini">Material completo do zero ao profissional, com foco em operação real, compliance e governança para empreendedores e equipes técnicas.</p>
            <div class="hero-actions">
              <a class="btn btn-primary" href="./assets/ebook-legislacao-drones-brasil-venda.pdf" target="_blank" rel="noopener noreferrer">Abrir E-book em PDF</a>
              <a class="btn btn-ghost" href="https://wa.me/5551980289009?text=Ol%C3%A1%2C%20quero%20o%20e-book%20de%20legisla%C3%A7%C3%A3o%20de%20drone%20no%20Brasil." target="_blank" rel="noopener noreferrer">Comprar via WhatsApp</a>
            </div>
          </div>
        </section>

        <section class="card span-2">
          <h2>Dados da missão</h2>
          <form id="missionForm" class="form-grid">
            <label>Operador
              <input id="operatorName" required placeholder="Nome do operador" />
            </label>
            <label>Piloto responsável
              <input id="pilotResponsible" placeholder="Nome do piloto responsável" />
            </label>
            <label>Drone
              <input id="droneModel" required placeholder="Ex.: DJI Mavic 3 Pro" />
            </label>
            <label>Cliente
              <input id="clientName" placeholder="Nome do cliente/empresa" />
            </label>
            <label>Tipo de missão
              <input id="missionType" placeholder="Ex.: inspeção, audiovisual, segurança" />
            </label>
            <label>Uso da missão
              <select id="missionUse">
                <option value="">Selecione</option>
                <option value="recreativo">Recreativo</option>
                <option value="nao_recreativo">Não recreativo</option>
              </select>
            </label>
            <label>Peso do drone (gramas)
              <input id="droneWeightG" type="number" min="0" step="1" placeholder="Ex.: 895" />
            </label>
            <label>Missão exige SARPAS?
              <select id="requiresSarpas">
                <option value="nao">Não</option>
                <option value="sim">Sim</option>
              </select>
            </label>
            <label>Local
              <input id="locationName" placeholder="Cidade / ponto da operação" />
            </label>
            <label>Latitude
              <input id="lat" type="number" step="any" placeholder="-23.5505" />
            </label>
            <label>Longitude
              <input id="lon" type="number" step="any" placeholder="-46.6333" />
            </label>
            <label>Data e hora
              <input id="flightDate" type="datetime-local" />
            </label>
            <label>Observações
              <input id="notes" placeholder="Restrições locais, cliente, perímetro..." />
            </label>
            <label>Log operacional da missão
              <input id="flightLog" placeholder="Ex.: decolagem 14:10, troca de bateria 14:28..." />
            </label>
            <label class="inline-check">
              <input id="hadIncident" type="checkbox" />
              Houve incidente/desvio nesta missão
            </label>
            <label>Descrição do incidente (se houver)
              <input id="incidentDetails" placeholder="Descreva incidente, ação tomada e resultado" />
            </label>
          </form>
        </section>

        <section class="card">
          <h2>Status de voo</h2>
          <div class="status-wrap">
            <p id="goNoGo" class="status status-warn">PENDENTE</p>
            <p id="statusReason" class="mini">Preencha checklist e clima para decisão automática.</p>
          </div>
          <div class="thresholds">
            <h3>Limites configuráveis</h3>
            <label>Vento máximo (km/h)
              <input id="maxWind" type="number" value="30" />
            </label>
            <label>Rajada máxima (km/h)
              <input id="maxGust" type="number" value="42" />
            </label>
            <label>Kp máximo
              <input id="maxKp" type="number" step="0.1" value="4" />
            </label>
            <button id="recheckBtn" class="btn btn-secondary" type="button">Recalcular GO/NO-GO</button>
          </div>
          <div id="complianceRuleBox" class="weather-box">
            <p class="mini">Regras operacionais automáticas ainda não avaliadas.</p>
          </div>
        </section>

        <section class="card">
          <h2>Conta e Nuvem</h2>
          <p id="cloudIndicator" class="mini">Cloud: local</p>
          <p id="authStatus" class="mini">Modo local ativo. Configure Supabase para login e nuvem.</p>
          <label>E-mail
            <input id="authEmail" type="email" placeholder="seuemail@dominio.com" />
          </label>
          <label>Senha
            <input id="authPassword" type="password" placeholder="Senha (mín. 6 caracteres)" />
          </label>
          <div class="auth-actions">
            <button id="signupBtn" class="btn btn-secondary" type="button">Criar conta</button>
            <button id="loginBtn" class="btn btn-primary" type="button">Entrar</button>
            <button id="logoutBtn" class="btn btn-ghost" type="button">Sair</button>
          </div>
          <div class="auth-actions">
            <button id="cloudPushBtn" class="btn btn-secondary" type="button">Enviar voos para nuvem</button>
            <button id="cloudPullBtn" class="btn btn-secondary" type="button">Baixar voos da nuvem</button>
          </div>
        </section>

        <section class="card span-2">
          <div class="between">
            <h2>Checklist pré-voo</h2>
            <div>
              <input id="newItemInput" placeholder="Adicionar item personalizado" />
              <button id="addItemBtn" class="btn btn-ghost" type="button">Adicionar</button>
            </div>
          </div>
          <ul id="checklist" class="checklist"></ul>
        </section>

        <section class="card span-2">
          <div class="between">
            <h2>Compliance documental</h2>
            <p class="mini">Alertas automáticos de vencimento (SISANT, SARPAS, ANATEL, RETA)</p>
          </div>
          <div class="form-grid">
            <label>SISANT - validade
              <input id="compSisantDate" type="date" />
            </label>
            <label>SARPAS - validade
              <input id="compSarpasDate" type="date" />
            </label>
            <label>ANATEL - validade
              <input id="compAnatelDate" type="date" />
            </label>
            <label>RETA - validade
              <input id="compRetaDate" type="date" />
            </label>
          </div>
          <div id="complianceAlerts" class="compliance-list"></div>
        </section>

        <section class="card">
          <h2>Clima ao vivo</h2>
          <p class="mini">Fonte: Open-Meteo (tempo real). Use junto com o UAV Forecast para decisão final.</p>
          <button id="weatherBtn" class="btn btn-secondary" type="button">Atualizar clima</button>
          <div id="weatherBox" class="weather-box">
            <p>Sem dados climáticos.</p>
          </div>
        </section>

        <section class="card">
          <h2>Conector UAV Forecast</h2>
          <p class="mini">Abra a interface e sincronize dados manualmente ou via JSON.</p>
          <label>URL da interface
            <input id="uavUrl" value="https://www.uavforecast.com/" />
          </label>
          <div class="uav-actions">
            <button id="openUavBtn" class="btn btn-secondary" type="button">Abrir UAV Forecast</button>
          </div>
          <label>Payload JSON (opcional)
            <textarea id="uavPayload" rows="5" placeholder='{"wind": 22, "gust": 30, "kp": 3.2, "satellites": 19}'></textarea>
          </label>
          <button id="syncUavBtn" class="btn btn-ghost" type="button">Sincronizar payload</button>
          <div id="uavData" class="weather-box">
            <p>Sem dados de integração.</p>
          </div>
        </section>
      </div>
    </section>

    <section id="screen-historico" class="tab-screen">
      <div class="grid">
        <section class="card span-3">
          <div class="between">
            <h2>Histórico de voos</h2>
            <button id="exportCsvBtn" class="btn btn-secondary" type="button">Exportar CSV</button>
          </div>
          <div class="history-filters">
            <input id="historySearch" placeholder="Buscar por ID, operador, piloto, drone, cliente ou local" />
            <select id="filterStatus">
              <option value="">Todos os status</option>
              <option value="GO">GO</option>
              <option value="NO-GO">NO-GO</option>
              <option value="PENDENTE">PENDENTE</option>
            </select>
            <select id="filterIncident">
              <option value="">Com ou sem incidente</option>
              <option value="com">Somente com incidente</option>
              <option value="sem">Somente sem incidente</option>
            </select>
            <button id="clearFiltersBtn" class="btn btn-ghost" type="button">Limpar filtros</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>ID missão</th>
                <th>Data</th>
                <th>Operador</th>
                <th>Piloto</th>
                <th>Drone</th>
                <th>Cliente</th>
                <th>Local</th>
                <th>Status</th>
                <th>Incidente</th>
                <th>Vento</th>
              </tr>
            </thead>
            <tbody id="historyBody"></tbody>
          </table>
        </section>

        <section class="card span-3">
          <div class="between">
            <h2>Trilha auditável</h2>
            <div class="hero-actions">
              <button id="exportAuditBtn" class="btn btn-secondary" type="button">Exportar auditoria</button>
              <button id="clearAuditBtn" class="btn btn-ghost" type="button">Limpar trilha</button>
            </div>
          </div>
          <table>
            <thead>
              <tr>
                <th>Data</th>
                <th>Usuário</th>
                <th>Ação</th>
                <th>Detalhe</th>
              </tr>
            </thead>
            <tbody id="auditBody"></tbody>
          </table>
        </section>
      </div>
    </section>

    <section id="storeView" class="tab-screen">
      <div class="grid">
        <section class="card span-2">
          <div class="between">
            <h2>Loja de operação</h2>
            <p class="mini">Edite itens em <code>data/store-items.js</code></p>
          </div>
          <div class="store-filters">
            <select id="storeCategoryFilter">
              <option value="">Todas as categorias</option>
            </select>
            <input id="storeSearch" placeholder="Buscar item por nome" />
            <select id="storeSort">
              <option value="name_asc">Ordenar: Nome (A-Z)</option>
              <option value="price_asc">Preço: menor primeiro</option>
              <option value="price_desc">Preço: maior primeiro</option>
            </select>
          </div>
          <div id="storeCatalog" class="store-grid"></div>
        </section>

        <section class="card">
          <h2>Carrinho</h2>
          <div id="cartItems" class="cart-items">
            <p class="mini">Carrinho vazio.</p>
          </div>
          <p class="cart-total">Total: <strong id="cartTotal">R$ 0,00</strong></p>
          <label>Observações para atendimento
            <textarea id="cartObs" rows="3" placeholder="Ex.: entrega em Porto Alegre, nota fiscal, urgência..."></textarea>
          </label>
          <div class="cart-actions">
            <button id="copyOrderBtn" class="btn btn-secondary" type="button">Copiar pedido</button>
            <button id="clearCartBtn" class="btn btn-ghost" type="button">Limpar carrinho</button>
            <button id="checkoutWhatsappBtn" class="btn btn-primary" type="button">Finalizar no WhatsApp</button>
          </div>
        </section>
      </div>
    </section>
  </main>

  <a
    class="floating-ebook-cta"
    href="https://wa.me/5551980289009?text=Ol%C3%A1%2C%20quero%20comprar%20o%20e-book%20de%20legisla%C3%A7%C3%A3o%20de%20drone%20no%20Brasil."
    target="_blank"
    rel="noopener noreferrer"
    aria-label="Comprar E-book no WhatsApp"
  >
    Comprar E-book
  </a>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="./data/supabase-config.js"></script>
  <script src="./data/store-items.js"></script>
  <script src="./app.js"></script>
</body>
</html>
